generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       String @id @default(uuid())
  username String @default("Username")
  email    String @unique
  hash     String

  profileImageSrc    String @default("https://res.cloudinary.com/birthdayreminder/image/upload/v1732365178/Research%20Manager/users/profileImages/abstract-user-flat-4_fimqzi.png")
  backgroundImageSrc String @default("https://res.cloudinary.com/birthdayreminder/image/upload/v1732365146/Research%20Manager/users/backgroundImages/signupwallpaper_der2zw.jpg")

  settings Settings?

  activityFeed       ActivityFeed[]
  tags               Tag[]
  researchActivities ResearchActivity[]

  archivedTags               Tag[]              @relation("archived")
  archivedResearchActivities ResearchActivity[] @relation("archived")
  archivedResearchPhases     ResearchPhase[]    @relation("archived")
  archivedResearchSessions   ResearchSession[]  @relation("archived")
  archivedResearchLogs       ResearchLog[]      @relation("archived")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Settings {
  id String @id @default(uuid())

  sidebarPosition             SettingsSidebarPosition @default(LEFT)
  warningOverlayTimeInSeconds Int                     @default(10)
  purgeDirectly               Boolean                 @default(false)
  allowNotifications          Boolean                 @default(false)

  user   User   @relation(fields: [userId], references: [id])
  userId String @unique

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

model Tag {
  id                        String @id @default(uuid())
  title                     String @default("Usual")
  backgroundColorOrImageSrc String @default("#D54E5D") // Pastel Red Hex Code
  fontSize                  Int    @default(16)
  fontFamily                String @default("Irish Grover")

  user                     User   @relation(fields: [userId], references: [id])
  userId                   String
  userForArchivePurposes   User   @relation("archived", fields: [userIdForArchivePurposes], references: [id])
  userIdForArchivePurposes String

  researchActivities ResearchActivity[]
  researchPhases     ResearchPhase[]
  researchSessions   ResearchSession[]
  researchLogs       ResearchLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ResearchActivity {
  id                        String @id @default(uuid())
  name                      String @default("Research Activity")
  backgroundColorOrImageSrc String @default("#D8E5E4") // Whiteish Hex Code

  user   User   @relation(fields: [userId], references: [id])
  userId String

  userForArchivePurposes   User   @relation("archived", fields: [userIdForArchivePurposes], references: [id])
  userIdForArchivePurposes String

  activityFeed ActivityFeed?

  tags           Tag[]
  researchPhases ResearchPhase[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ResearchPhase {
  id                        String @id @default(uuid())
  name                      String @default("Research Phase")
  backgroundColorOrImageSrc String @default("#D8E5E4") // Whiteish Hex Code

  researchActivity   ResearchActivity @relation(fields: [researchActivityId], references: [id])
  researchActivityId String

  userForArchivePurposes   User   @relation("archived", fields: [userIdForArchivePurposes], references: [id])
  userIdForArchivePurposes String

  tags             Tag[]
  researchSessions ResearchSession[]
  researchLogs     ResearchLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ResearchLog {
  id                        String   @id @default(uuid())
  name                      String   @default("Research Log")
  backgroundColorOrImageSrc String   @default("#D8E5E4") // Whiteish Hex Code
  researchPoints            Int      @default(0)
  content                   String   @default("No content written.")
  imagesSrc                 String[] @default([])

  userForArchivePurposes   User   @relation("archived", fields: [userIdForArchivePurposes], references: [id])
  userIdForArchivePurposes String

  researchPhase   ResearchPhase @relation(fields: [researchPhaseId], references: [id])
  researchPhaseId String

  tags Tag[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ResearchSession {
  id                        String   @id @default(uuid())
  name                      String   @default("Research Session")
  backgroundColorOrImageSrc String   @default("#D8E5E4") // Whiteish Hex Code
  researchPoints            Int      @default(0)
  content                   String   @default("No content written.")
  imagesSrc                 String[] @default([])

  currentStatusType ResearchSessionStatusType @default(STARTED)
  currentStatusDate DateTime                  @default(now())

  userForArchivePurposes   User   @relation("archived", fields: [userIdForArchivePurposes], references: [id])
  userIdForArchivePurposes String

  researchPhase   ResearchPhase @relation(fields: [researchPhaseId], references: [id])
  researchPhaseId String

  tags Tag[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ActivityFeed {
  id   String           @id @default(uuid())
  type ActivityFeedType @default(USER)

  user               User?             @relation(fields: [userId], references: [id])
  userId             String?           @unique
  researchActivity   ResearchActivity? @relation(fields: [researchActivityId], references: [id])
  researchActivityId String?           @unique

  dayActivities ActivityDay[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ActivityDay {
  id String @id @default(uuid())

  activityFeed   ActivityFeed  @relation(fields: [activityFeedId], references: [id])
  activityFeedId String
  activities     ActivityLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ActivityLog {
  id            String          @id @default(uuid())
  createdAt     DateTime        @default(now())
  subject       ActivitySubject @default(OTHER)
  message       String          @default("Other activity noticed, something is very wrong. The apocalypse is coming. Run.")
  messageValues String[]        @default([])

  dayActivities ActivityDay[]
}

enum SettingsSidebarPosition {
  LEFT
  RIGHT
}

enum ResearchSessionStatusType {
  STARTED
  PAUSED
  RESUMED
  FINISHED
}

enum ActivityFeedType {
  USER
  RESEARCH_ACTIVITY
}

enum ActivitySubject {
  CREATE
  UPDATE
  DELETE
  RESTORE
  PURGE
  RESEARCH_START
  RESEARCH_PAUSE
  RESEARCH_RESUME
  RESEARCH_END
  SETTINGS
  OTHER
}
